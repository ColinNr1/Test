<!doctype html>
<html lang="de">
<head>
<meta charset="utf-8">
<title>Excel Import â€“ FIXED</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<!-- XLSX LIBRARY â€“ zuverlÃ¤ssig -->
<script
  src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.19.3/xlsx.full.min.js"
  integrity="sha512-fQ2p+Y4xXHzkwmo7aX6ixkmKuuNHYsYvwdivgLPgAvFp8ZUBKbjsgg7sWXBJgp7wa9u0edPFpKnz03WxZmf0Rg=="
  crossorigin="anonymous"
  referrerpolicy="no-referrer">
</script>

<style>
body{
  background:#0b1020;
  color:#e7ecff;
  font-family:Arial, sans-serif;
  padding:20px;
}
button,input{padding:10px;margin:5px 0}
#log{background:#000;padding:10px;margin-top:10px;font-size:12px}
#barWrap{width:100%;height:18px;background:#222;border-radius:5px;overflow:hidden}
#bar{height:100%;width:0%;background:#7c5cff}
table{width:100%;border-collapse:collapse;margin-top:20px;font-size:12px}
th,td{border:1px solid #333;padding:6px}
th{background:#101a33}
</style>
</head>

<body>

<h1>Excel Import â€“ FINAL FIX</h1>

<input type="file" id="fileInput" accept=".xlsx,.xls">
<button id="btn">Excel importieren</button>

<div id="barWrap"><div id="bar"></div></div>
<pre id="log"></pre>

<table>
  <thead id="thead"></thead>
  <tbody id="tbody"></tbody>
</table>

<script>
const logEl = document.getElementById("log");
const bar = document.getElementById("bar");

function log(msg){
  console.log(msg);
  logEl.textContent += msg + "\n";
}

function progress(p){ bar.style.width = p + "%"; }

// ðŸ”´ HARTE PRÃœFUNG
if (typeof XLSX === "undefined") {
  log("âŒ XLSX NICHT GELADEN");
  alert("Excel Library (XLSX) konnte nicht geladen werden.\nBitte Cache leeren oder CDN prÃ¼fen.");
} else {
  log("âœ… XLSX geladen: " + XLSX.version);
}

document.getElementById("btn").onclick = () => {
  if (typeof XLSX === "undefined") {
    alert("XLSX fehlt â€“ Import abgebrochen");
    return;
  }

  const file = document.getElementById("fileInput").files[0];
  if (!file) {
    alert("Bitte Excel auswÃ¤hlen");
    return;
  }

  log("ðŸ“‚ Datei: " + file.name);
  progress(10);

  const reader = new FileReader();

  reader.onload = e => {
    progress(30);
    const data = new Uint8Array(e.target.result);
    log("ðŸ“¥ Datei gelesen");

    const wb = XLSX.read(data, { type: "array" });
    log("ðŸ“„ Sheets: " + wb.SheetNames.join(", "));
    progress(60);

    const sheet = wb.Sheets[wb.SheetNames[0]];
    const rows = XLSX.utils.sheet_to_json(sheet, { header: 1 });

    log("ðŸ“Š Zeilen: " + rows.length);
    progress(80);

    render(rows);
    progress(100);
    log("âœ… Fertig");
  };

  reader.readAsArrayBuffer(file);
};

function render(rows){
  const thead = document.getElementById("thead");
  const tbody = document.getElementById("tbody");
  thead.innerHTML = "";
  tbody.innerHTML = "";

  const hr = document.createElement("tr");
  rows[0].forEach(h => {
    const th = document.createElement("th");
    th.textContent = h;
    hr.appendChild(th);
  });
  thead.appendChild(hr);

  for (let i = 1; i < rows.length; i++) {
    const tr = document.createElement("tr");
    rows[i].forEach(c => {
      const td = document.createElement("td");
      td.textContent = c ?? "";
      tr.appendChild(td);
    });
    tbody.appendChild(tr);
  }
}
</script>

</body>
</html>
